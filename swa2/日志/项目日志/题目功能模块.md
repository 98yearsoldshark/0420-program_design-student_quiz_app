# 题目功能模块

## 功能概述
题目模块是小程序的核心功能之一，提供题目列表浏览、筛选和详情查看功能。支持显示LaTeX公式题目和图片题目两种类型。

## 实现细节

### 题目列表页面
- 路径：`pages/questions/list/list`
- 功能：
  - 显示题目列表
  - 支持按科目、年级、年份和类型进行筛选
  - 支持下拉刷新和上拉加载更多
  - 点击题目进入详情页

- 核心API：
  - `questionApi.getQuestionList`：获取题目列表
  - `fileApi.getFolders`：获取科目列表

### 题目详情页面
- 路径：`pages/questions/detail/detail`
- 功能：
  - 显示题目基本信息（科目、年级、年份、类型）
  - 显示LaTeX公式题目
  - 显示图片题目
  - 显示题目答案和注释
  - 支持分享和收藏功能

- 核心API：
  - `questionApi.getQuestionDetail`：获取题目详情（备选方案）
  - `fileApi.getImages`：获取题目图片

### 页面间数据传递优化
为了减少网络请求，提高应用性能，采用了以下优化策略：

1. **直接传递题目数据**：
   - 从列表页跳转到详情页时，通过URL参数传递完整题目数据
   - 避免重复请求已获取的题目信息
   ```javascript
   // 列表页跳转代码
   const question = this.data.questions.find(item => item.id === id);
   wx.navigateTo({
     url: `/pages/questions/detail/detail?id=${id}&questionData=${encodeURIComponent(JSON.stringify(question))}`
   });
   ```

2. **备选API请求机制**：
   - 当数据传递失败时，回退到API请求方式
   - 确保在极端情况下应用仍能正常工作
   ```javascript
   // 详情页获取数据代码
   if (options.questionData) {
     // 从URL参数中解析题目数据
   } else if (options.id) {
     // 回退到API请求
     this.loadQuestionDetail(options.id);
   }
   ```

### LaTeX公式渲染
- 使用第三方库`@rojer/katex-mini`进行渲染
- 需要在`app.wxss`中导入样式：`@import "./miniprogram_npm/@rojer/katex-mini/index.wxss";`
- 渲染方式：
  ```javascript
  import parse from '@rojer/katex-mini';
  
  // 在页面中调用解析
  const nodes = parse(latexCode, {
    throwError: false,
    displayMode: true
  });
  
  // 设置到页面数据中
  this.setData({
    latexNodes: nodes
  });
  
  // 在wxml中使用rich-text组件显示
  // <rich-text nodes="{{latexNodes}}"></rich-text>
  ```

## 问题与解决方案
1. **LaTeX公式不显示问题**
   - 原因：缺少必要的样式文件
   - 解决：在app.wxss中导入`@rojer/katex-mini`的样式

2. **API 404问题**
   - 原因：API路径错误，`getQuestionDetail`方法中使用了错误的路径参数
   - 解决：修改API调用，使用ID作为参数

3. **重复请求题目数据问题**
   - 原因：从列表页跳转到详情页时，会重新请求已获取过的题目数据
   - 解决：在跳转时通过URL参数传递完整题目数据，避免重复请求

## 待优化项目
1. 增强LaTeX公式渲染功能，支持更复杂的公式
2. 添加题目收藏功能的后端实现
3. 优化图片题目的加载速度和显示效果
4. 添加公式题目的搜索功能
5. 考虑使用本地缓存存储常用题目数据，减少网络请求 